<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autorizza PI</title>
</head>
<body>
<h1>Autorizza PI</h1>
<form id="autorizzaForm">
    <label for="idPI">ID PI:</label>
    <input type="text" id="idPI" name="idPI">
    <button type="button" onclick="autorizza()">Autorizza</button>
</form>

<h2>ottieni Segnalazione</h2>
<label for="idSegnalazione">id Segnalazione:</label>
<input type="text" id="idSegnalazione">
<button onclick="getSegnalazione()">ottieni Segnalazione</button>
<div id="segnalazioneResult"></div>

<h1>Ottieni segnalazioni</h1>
<button onclick="getSegnalazioni()">ottieni segnalazioni</button>
<h2>Segnalazioni List</h2>
<ul id="segnalazioniList"></ul>

<h1>Ottieni lista elementi da autorizzare</h1>
<button onclick="getLista()">ottieni lista</button>
<h2>lista </h2>
<ul id="listaList"></ul>

<h1>Ottieni lista pi da autorizzare</h1>
<button onclick="getPI()">ottieni lista pi</button>
<h2>lista </h2>
<ul id="piList"></ul>

<h1>Gestisci Segnalazione</h1>
<p>Inserisci l'ID della segnalazione che desideri gestire:</p>
<input type="text" id="idS" placeholder="idS">
<button onclick="gestisciSegnalazione()">Gestisci</button>


<h1>Autorizza elemento</h1>
<form id="autorizzaForm1">
    <label for="idElemento">ID Elemento:</label>
    <input type="text" id="idElemento" name="idElemento">
    <button type="button" onclick="autorizzaElemento()">Autorizza</button>
</form>

<script>
    if (!sessionStorage.getItem('isAuthenticated')) {
        window.location.href = '/login.html';
    }
    const baseUrl = 'http://localhost:8080';
    function autorizza() {
        var idPI = document.getElementById('idPI').value;

        // Crea un oggetto PI con l'ID inserito
        var piData = {
            idPI: idPI
        };

        // Esegui una richiesta POST per autorizzare il PI
        fetch(`${baseUrl}/autorizza/idPI?idPI=${encodeURIComponent(idPI)}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(piData),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('autorizzato', data.idPI);

            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Error', error);
            });
    }
    function autorizzaElemento() {
        var idElemento = document.getElementById('idElemento').value;
         var elementoData = {
            idElemento: idElemento
        };

        fetch(`${baseUrl}/autorizzazione/idElemento?idElemento=${encodeURIComponent(idElemento)}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(elementoData),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('autorizzato',data.idElemento);
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('errore')
            });
    }
    function getSegnalazioni() {
        fetch(`${baseUrl}/getSegnalazioni`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore nella richiesta.');
                }
                return response.json();
            })
            .then(data => {
                const segnalazioniList = document.getElementById('segnalazioniList');
                segnalazioniList.innerHTML = ''

                data.forEach(segnalazione => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `ID: ${segnalazione.idSegnalazione}, Descrizione: ${segnalazione.descrizione}`;
                    segnalazioniList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Errore:', error);
                alert('Si è verificato un errore durante il recupero delle segnalazioni.');
            });
    }
    function getLista() {
        fetch(`${baseUrl}/getListaDaAutorizzare`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore nella richiesta.');
                }
                return response.json();
            })
            .then(data => {
                const listaList = document.getElementById('listaList');
                listaList.innerHTML = '';

                data.forEach(elemento => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `ID: ${elemento.idElemento},Titolo: ${elemento.titolo}, Descrizione: ${elemento.descrizione}`;
                    listaList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Errore:', error);
                alert('Si è verificato un errore durante il recupero delle segnalazioni.');
            });
    }
    function getPI() {
        fetch(`${baseUrl}/getPIDaAutorizzare`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore nella richiesta.');
                }
                return response.json();
            })
            .then(data => {
                const piList = document.getElementById('piList');
                piList.innerHTML = '';
                data.forEach(pi => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `ID: ${pi.idPI},Titolo: ${pi.titolo}, Descrizione: ${pi.descrizione}`;
                    piList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Errore:', error);
                alert('Si è verificato un errore durante il recupero delle segnalazioni.');
            });
    }

    function getSegnalazione() {
        const idSegnalazione = document.getElementById('idSegnalazione').value;

        fetch(`${baseUrl}/segnalazione/idSegnalazione?idSegnalazione=${encodeURIComponent(idSegnalazione)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Errore nella richiesta.');
                }
                return response.json();
            })
            .then(segnalazione => {
                const segnalazioneResult = document.getElementById('segnalazioneResult');
                if (segnalazione!=null) {
                    segnalazioneResult.textContent = `ID: ${segnalazione.idSegnalazione}, Descrizione: ${segnalazione.descrizione},IdElemento: ${segnalazione.idElemento}`;
                } else {
                    segnalazioneResult.textContent = `Segnalazione non trovata.`;
                }
            })
            .catch(error => console.error('Errore:', error));
    }
    function gestisciSegnalazione() {
        var idS = document.getElementById('idS').value;

        fetch(`${baseUrl}/gestisci/idSegnalazione?idSegnalazione=${encodeURIComponent(idS)}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (response.ok) {
                    console.log('Segnalazione gestita con successo');
                    alert('Segnalazione gestita  con successo!');
                } else {
                    console.error('Errore durante la gestione della segnalazione');
                    alert('Errore durante la gestione della segnalazione')
                }
            })
            .catch(error => {
                console.error('Errore:', error);
                alert('Segnalazione non gestita!');
            });
    }


</script>
</body>
</html>
